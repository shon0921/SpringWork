<!DOCTYPE html>
<html lang="ko">

<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />

  <title>ë‚´ ì •ë³´</title>

  <link href="/vendor/fontawesome-free/css/all.min.css" rel="stylesheet" type="text/css" />
  <link href="https://fonts.googleapis.com/css?family=Nunito:200,300,400,600,700,800,900" rel="stylesheet" />

  <link href="/css/sb-admin-2.min.css" rel="stylesheet" />

  <style>
    .custom-card {
      max-width: 500px;
      height: 640px;
      margin: auto;
      background-color: white;
      border-radius: 12px;
      padding: 40px 20px;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    .user {
      display: flex;
      flex-direction: column;
      align-items: center;
      width: 100%;
    }

    h1 {
      font-size: 2rem;
      font-weight: 700;
      margin-bottom: 30px;
      color: #000;
    }

    .info-text {
      width: 100%;
      background-color: #f8f9fc;
      padding: 15px;
      margin: 10px 0;
      font-size: clamp(1rem, 2.5vw, 1.2rem);
      font-weight: 500;
      color: #000;
      text-align: center;
      border-radius: 8px;
    }

    .menu-button {
      font-size: clamp(1rem, 2vw, 1.3rem);
      height: clamp(45px, 5vw, 65px);
      width: 100%;
      max-width: 500px;
      margin: 10px 0;
      border-radius: 12px;
      font-weight: 500;
      background-color: #e0e0e0;
      color: #000;
      border: none;
      cursor: pointer;
      transition: background-color 0.2s ease;
    }

    .menu-button:hover {
      background-color: #d0d0d0;
    }

    .menu-button.red {
      background-color: #e57373;
      color: white;
    }

    .menu-button.red:hover {
      background-color: #d32f2f;
    }

    #backButton {
      position: absolute;
      top: 20px;
      left: 20px;
      z-index: 10;
      background: none;
      border: none;
      padding: 0;
      cursor: pointer;
      font-size: 1.5rem;
      color: #858796;
    }

    #backButton:hover {
      color: #5a5c69;
    }
  </style>

  <script type="text/javascript" src="/js/jquery-3.6.0.min.js"></script>
  <script type="text/javascript">
    $(document).ready(function () {

      let userInfo;

      // --- 1. í˜ì´ì§€ ë¡œë”© ì‹œ, APIë¥¼ í˜¸ì¶œí•˜ì—¬ ì‚¬ìš©ì ì •ë³´ ê°€ì ¸ì˜¤ê¸° ---
      $.ajax({
        url: "/user/info",
        type: "get",
        dataType: "JSON",
        contentType: "application/json",
        success: function (json) {
          if (json.data) {
            userInfo = json.data;

            // ì•„ì´ë””ì™€ ê°€ì…ì¼ì„ ê°ê°ì˜ divì— í…ìŠ¤íŠ¸ë¡œ ë„£ì–´ì¤Œ
            $("#userIdText").text("ì•„ì´ë””: " + userInfo.userId);
            $("#regDtText").text("ê°€ì…ì¼: " + userInfo.regDt);
          }
        },
        error: function (xhr) {
          if (xhr.status === 401) {
            alert("ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.");
            location.href = "/html/login.html";
          } else {
            alert("ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤: " + xhr.responseJSON.message);
          }
        }
      });

      // --- 2. ê¸°ì¡´ ë²„íŠ¼ ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬ë“¤ ---
      $("#backButton").on("click", function () {
        location.href = "/main/title";
      });

      // --- ì´ì œ userInfo ë³€ìˆ˜ì— ì •ìƒì ìœ¼ë¡œ ì ‘ê·¼í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤ ---
      $("#changepassword").on("click", function () {
        // userInfo ë³€ìˆ˜ê°€ í• ë‹¹ë  ë•Œê¹Œì§€ ì ì‹œ ê¸°ë‹¤ë ¤ì¤ë‹ˆë‹¤. (ì•ˆì „ì¥ì¹˜)
        if (!userInfo) {
          alert("ì‚¬ìš©ì ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ì…ë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.");
          return;
        }

        if (userInfo.provider === "naver") {
          alert("ì†Œì…œ ë¡œê·¸ì¸ ì‚¬ìš©ìëŠ” ë¹„ë°€ë²ˆí˜¸ë¥¼ ë³€ê²½í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
        } else {
          location.href = "/main/changepassword";
        }
      });

      $("#inquiry").on("click", function () {
        location.href = "/main/inquiry/inquiryList";
      });

      // 'íšŒì›íƒˆí‡´' ë²„íŠ¼ í´ë¦­ ì´ë²¤íŠ¸ ìˆ˜ì •
      $("#delete").on("click", function () {
        if (!userInfo) {
          alert("ì‚¬ìš©ì ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ì…ë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.");
          return;
        }

        // --- ğŸš¨ ì—¬ê¸°ê°€ í•µì‹¬ì…ë‹ˆë‹¤ ---
        // 1. ë„¤ì´ë²„ íšŒì›ì¸ ê²½ìš°
        if (userInfo.provider === "naver") {
          if (confirm("ë¹„ë°€ë²ˆí˜¸ í™•ì¸ ì—†ì´ ì¦‰ì‹œ íƒˆí‡´ ì²˜ë¦¬ë©ë‹ˆë‹¤.\nì •ë§ íƒˆí‡´í•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) {
            // "ì˜ˆ"ë¥¼ ëˆ„ë¥´ë©´, ë¹„ë°€ë²ˆí˜¸ ì—†ì´ ë°”ë¡œ íƒˆí‡´ì‹œí‚¤ëŠ” APIë¥¼ í˜¸ì¶œí•©ë‹ˆë‹¤.
            $.ajax({
              url: "/user/delete-social", // ì†Œì…œ ì „ìš© íƒˆí‡´ API
              type: "post",
              dataType: "JSON",
              success: function (json) {
                alert(json.msg);
                if (json.result === 1) {
                  sessionStorage.clear();
                  location.href = "/";
                }
              },
              error: function() {
                alert("íšŒì›íƒˆí‡´ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");
              }
            });
          }
        } else {
          // 2. ì¼ë°˜ íšŒì›ì¸ ê²½ìš°
          // ê¸°ì¡´ì²˜ëŸ¼ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ëŠ” í˜ì´ì§€ë¡œ ì´ë™í•©ë‹ˆë‹¤.
          location.href = "/main/accountdelete";
        }
      });

      $("#logout").on("click", function () {
        if (confirm("ë¡œê·¸ì•„ì›ƒ í•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) {
          $.ajax({
            url: "/user/logout",
            type: "POST",
            dataType: "json",
            success: function (json) {
              alert(json.msg);
              if (json.result === 1) {
                sessionStorage.clear();
                location.href = "/";
              }
            },
            error: function() {
              alert("ë¡œê·¸ì•„ì›ƒ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");
            }
          });
        }
      });
    });
  </script>
</head>

<body class="bg-gradient-primary">
<div class="container">
  <div class="card o-hidden border-0 shadow-lg my-5 custom-card">
    <button type="button" id="backButton">
      <i class="fas fa-chevron-left"></i>
    </button>
    <div class="user">
      <h1>ë‚´ì •ë³´</h1>

      <div id="userIdText" class="info-text"></div>
      <div id="regDtText" class="info-text"></div>

      <button id="changepassword" type="button" class="menu-button">ë¹„ë°€ë²ˆí˜¸ ë³€ê²½</button>
      <button id="inquiry" type="button" class="menu-button">ë¬¸ì˜í•˜ê¸°</button>
      <button id="logout" type="button" class="menu-button">ë¡œê·¸ì•„ì›ƒ</button>
      <button id="delete" type="button" class="menu-button red">íšŒì›íƒˆí‡´</button>
    </div>
  </div>
</div>

<script src="/vendor/bootstrap/js/bootstrap.bundle.min.js"></script>
<script src="/vendor/fontawesome-free/js/all.min.js"></script>
</body>

</html>